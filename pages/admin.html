<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mindora • Admin</title>
    <link rel="stylesheet" href="../assets/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/bootstrap/swiper-bundle.min.css">
    <link href="../assets/css/style.css?v=1" rel="stylesheet">
    <link href="../assets/css/responsive.css" rel="stylesheet">
    <link href="../assets/css/color.css" rel="stylesheet">
  </head>
  <body style="background: url(../assets/img/background/bg2.png); background-size: cover; background-position: center; background-attachment: fixed; ">
    <div class="container my-4">
      <div id="header"></div>
      <h1 class="h4 mb-3">Add Blog Post</h1>
      <div class="row g-4">
        <div class="col-12 col-lg-6">
          <form id="postForm" class="needs-validation" novalidate>
            <div class="mb-3">
              <label class="form-label">Title</label>
              <input id="fTitle" type="text" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Category</label>
              <select id="fCategory" class="form-select" required>
                <option value="Aerobics">Aerobics</option>
                <option value="Meditation">Meditation</option>
                <option value="Breathing">Breathing</option>
                <option value="Poses">Poses</option>
                <option value="Health">Health</option>
                <option value="Nutrition">Nutrition</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Excerpt</label>
              <textarea id="fExcerpt" class="form-control" rows="2" required></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Featured image</label>
              <input id="fImageFile" type="file" class="form-control" accept="image/*">
              <small class="text-muted">Or image URL</small>
              <input id="fImageUrl" type="url" class="form-control mt-1" placeholder="https://...">
            </div>
            <div class="mb-3">
              <label class="form-label">Content</label>
              <textarea id="fContent" class="form-control" rows="8" required></textarea>
            </div>
            <div class="mb-3 form-check">
              <input id="fFeatured" class="form-check-input" type="checkbox">
              <label class="form-check-label" for="fFeatured">Mark as featured</label>
            </div>
            <div class="d-flex gap-2">
              <button id="btnGenerate" class="btn btn-primary rounded-pill" type="submit">Generate Post</button>
              <button id="btnExportManifest" class="btn btn-outline-secondary rounded-pill" type="button">Export Manifest</button>
            </div>
            <div id="adminMsg" class="mt-2 text-danger"></div>
          </form>
        </div>
        <div class="col-12 col-lg-6">
          <div class="border rounded-4 shadow p-3 glass">
            <h2 class="h6">Preview</h2>
            <div id="preview" class="ratio ratio-16x9 border rounded-4 d-flex align-items-center justify-content-center">Add content to preview</div>
          </div>
        </div>
      </div>
      <div id="footer" class="mt-4"></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <script src="../assets/js/app.min.js?v=1"></script>
    <script src="../assets/js/blog.js"></script>
    <script>
      window.Components && window.Components.init && window.Components.init();
      (function(){
        function getImage(){
          var file = document.getElementById('fImageFile').files[0];
          var url = document.getElementById('fImageUrl').value.trim();
          return new Promise(function(resolve){
            if (url) return resolve(url);
            if (!file) return resolve('https://picsum.photos/seed/new/600/400');
            var r = new FileReader(); r.onload = function(){ resolve(r.result); }; r.readAsDataURL(file);
          });
        }
        function postHtml(meta){
          return '<!DOCTYPE html><html lang="en" data-bs-theme="light"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>'+meta.title+' • Mindora</title><link rel="stylesheet" href="../../assets/css/bootstrap/bootstrap.min.css"><link rel="stylesheet" href="../../assets/css/bootstrap/swiper-bundle.min.css"><link href="../../assets/css/style.css?v=1" rel="stylesheet"><link href="../../assets/css/color.css" rel="stylesheet"><link href="../../assets/css/responsive.css" rel="stylesheet">
</head><body style="background: url(../../assets/img/background/bg.avif); background-size: cover; background-position: center; background-attachment: fixed; "><div class="container my-3"><div id="header"></div><article class="border rounded-4 shadow p-4 glass"><header class="mb-3"><span class="badge text-bg-primary">'+meta.category+'</span><h1 class="h3 mt-2">'+meta.title+'</h1><small class="text-muted">'+new Date().toLocaleDateString()+'</small></header><div class="ratio ratio-16x9 mb-3"><img src="'+meta.image+'" alt="'+meta.title+'" style="object-fit:cover;width:100%;height:100%"></div><div class="content">'+meta.content.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')+'</div></article><div class="mt-3"><a class="btn btn-outline-primary rounded-pill" href="/pages/blog.html">Back to blog</a></div><div id="footer" class="mt-4"></div></div><script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script><script src="../../assets/js/app.min.js?v=1"></script></body></html>';
        }
        function download(filename, text){ var a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([text],{type:'text/html'})); a.download=filename; a.click(); }
        document.getElementById('postForm').addEventListener('submit', function(e){ e.preventDefault(); var form=this; if (!form.checkValidity()){ form.classList.add('was-validated'); return; } var msg=document.getElementById('adminMsg'); msg.textContent=''; var title=document.getElementById('fTitle').value.trim(); var cat=document.getElementById('fCategory').value; var excerpt=document.getElementById('fExcerpt').value.trim(); var featured=document.getElementById('fFeatured').checked; var content=document.getElementById('fContent').value; getImage().then(function(img){ var slug=title.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); var catSlug=cat.toLowerCase(); var url='/posts/'+catSlug.charAt(0).toUpperCase()+catSlug.slice(1)+'/'+slug+'.html'; var meta={ title:title, category:cat, excerpt:excerpt, image:img, url:url, date:new Date().toISOString().slice(0,10), featured:featured, content:content }; document.getElementById('preview').innerHTML='<img src="'+img+'" alt="'+title+'" style="object-fit:cover;width:100%;height:100%">'; if (window.Blog && typeof window.Blog.addLocalPost==='function'){ window.Blog.addLocalPost(meta); } download(slug+'.html', postHtml(meta)); }); });
        document.getElementById('btnExportManifest').addEventListener('click', function(){ if (!window.Blog || !window.Blog.loadAll) return; window.Blog.loadAll().then(function(all){ var a = document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(all,null,2)],{type:'application/json'})); a.download='posts.json'; a.click(); }); });
      })();
    </script>
  </body>
</html>
